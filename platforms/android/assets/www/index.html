<!DOCTYPE html>
<html>
  <head>
    <title>Bootstrap 101 Template</title>
    <meta http-equiv="content-type" content="application/xhtml+xml; charset=UTF-8" />
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <!-- Bootstrap -->
    <link href="bootstrap/css/bootstrap.min.css" rel="stylesheet" media="screen">
    <!-- HTML5 shim and Respond.js IE8 support of HTML5 elements and media queries -->
    <!--[if lt IE 9]>
      <script src="assets/js/html5shiv.js"></script>
      <script src="assets/js/respond.min.js"></script>
    <![endif]-->
  </head>
  <!--
  nombre
  rut

-->
  <body>
    <div class="container">
        <div class="row">

            <div class="col-md-6">
                <form role="form">
                  <div class="form-group">
                    <label for="f_name">Nombre</label>
                    <input type="text" class="form-control" id="f_name" placeholder="Nombre de cliente">
                  </div>
                  <div class="form-group">
                    <label for="f_rut">Rut</label>
                    <input type="text" class="form-control" id="f_rut" placeholder="Rut de cliente">
                  </div>
                  <div class="form-group">
                    <label for="f_email">Correo electr√≥nico</label>
                    <input type="email" class="form-control" id="f_email" placeholder="Email">
                  </div>
                </form>
                <button class="btn btn-info btn-lg btn-block">Limpiar</button>
            </div>
            <div class="col-md-6">
                <div class="form-group">
                    <a href="#" class="thumbnail" id="f_foto">
                        <img data-src="js/holder.js/300x168" id="img-preview">
                    </a>
                    <center><label for="f_foto">Toque para tomar foto</label></center>
                </div>
                <button class="btn btn-primary btn-lg btn-block" id="btn_reg">Registrar</button>
            </div>
        </div>
    </div>

    <!-- jQuery (necessary for Bootstrap's JavaScript plugins) -->
    <script src="js/jquery.js"></script>
    <!-- Include all compiled plugins (below), or include individual files as needed -->
    <script src="bootstrap/js/bootstrap.min.js"></script>
    <script type="text/javascript" src="js/holder.js"></script>
    <script type="text/javascript" src="phonegap.js"></script>
    <script type="text/javascript">
    function errorhandler(err)
    {
        console.log("db error! : " + err);
    }
    function successhandler()
    {
        console.log("good");
    }
    function querySuccess(tx, results)
    {
        alert(results.insertId);
    }
    $(function()
    {
        document.addEventListener("deviceready", function()
        {
            var dbhandler = window.openDatabase("userdb", "1.0", "Users DB", 2*1024*1024); // 2 MB
            dbhandler.transaction(function(tx)
            {
                tx.executeSQL("CREATE TABLE IF NOT EXISTS users (rut varchar(15), nombre varchar(150), foto varchar(200))");
            }, errorhandler, successhandler);

            $("#f_foto").on("click", function(ev)
            {
                try
                {
                    ev.preventDefault();
                    var onSuccess = function(imageURI)
                    {
                        $("#img-preview").attr("src", imageURI);
                    };
                    var onFail = function(msg)
                    {
                        alert(msg);
                    };
                    navigator.camera.getPicture(onSuccess, onFail, { quality: 50, destinationType: navigator.camera.DestinationType.FILE_URI, correctOrientation: false, targetHeight: -1, targetWidth: -1, cameraDirection: navigator.camera.Direction.BACK });
                }
                catch(e)
                {
                    alert(e);
                }
                return false;

            });
            $("#btn_reg").click(function(ev)
            {
                var nombre = $("#f_name").val();
                var rut = $("#f_rut").val();
                var foto = $("#img-preview").attr("src");
                dbhandler.transaction(function(tx)
                {
                    tx.executeSQL('INSERT INTO users (rut, nombre, foto) VALUES ("'+rut+'","'+nombre+'","'+foto+'")', [], querySuccess, null);
                }, errorhandler, successhandler);
            });
        },false);
    });
    </script>
  </body>
</html>